name: install-mingw
runs:
  using: composite
  steps:
  - name: Install mingw
    run: |-
      sudo apt update
      # This package contains tools for both i686 and x86_64 targets
      sudo apt install -y gcc-mingw-w64
    shell: bash
  - name: Add mingw target
    run: |-
      rustup target add x86_64-pc-windows-gnu
      rustup target add i686-pc-windows-gnu
      # Set the linker to use for Rust/mingw
      echo '[target.x86_64-pc-windows-gnu]' >> ~/.cargo/config
      echo 'linker = "/usr/bin/x86_64-w64-mingw32-gcc"' >> ~/.cargo/config
      echo '[target.i686-pc-windows-gnu]' >> ~/.cargo/config
      echo 'linker = "/usr/bin/i686-w64-mingw32-gcc"' >> ~/.cargo/config
    shell: bash